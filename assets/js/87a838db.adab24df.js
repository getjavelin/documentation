"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[7592],{10098:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>u,frontMatter:()=>r,metadata:()=>i,toc:()=>d});var s=a(74848),n=a(28453);const r={},o="Custom Guardrails",i={id:"javelin-processors/javascript",title:"Custom Guardrails",description:"Javelin can be extended with custom guardrails to enable additional functionality. Custom guardrails can be used to perform custom operations on the input data before it is sent to the model or on the output data before it is returned to the user. Custom guardrails can also be used to implement custom data transformations, data validation, data augmentation, and more.",source:"@site/docs/javelin-processors/javascript.md",sourceDirName:"javelin-processors",slug:"/javelin-processors/javascript",permalink:"/docs/javelin-processors/javascript",draft:!1,unlisted:!1,editUrl:"https://github.com/getjavelin/documentation/tree/main/docs/javelin-processors/javascript.md",tags:[],version:"current",frontMatter:{},sidebar:"someSidebar",previous:{title:"Hallucination Detection",permalink:"/docs/javelin-processors/hallucination"},next:{title:"Overview",permalink:"/docs/javelin-core/playground/overview"}},c={},d=[{value:"Configuration Options",id:"configuration-options",level:2},{value:"JavaScript Processor Interface",id:"javascript-processor-interface",level:2},{value:"Custom Validator",id:"custom-validator",level:2}];function l(e){const t={code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,n.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.h1,{id:"custom-guardrails",children:"Custom Guardrails"}),"\n",(0,s.jsx)(t.p,{children:"Javelin can be extended with custom guardrails to enable additional functionality. Custom guardrails can be used to perform custom operations on the input data before it is sent to the model or on the output data before it is returned to the user. Custom guardrails can also be used to implement custom data transformations, data validation, data augmentation, and more."}),"\n",(0,s.jsx)(t.p,{children:"Javelin executes a processor chain configured as a directed acyclic graph(DAG) of processors. Each processor in the chain is a self-contained module designed to perform a specific function. The processors are arranged in a sequence to facilitate complex processing sequences and ensure the execution flow is efficient, logical, and adaptable to various enterprise needs."}),"\n",(0,s.jsx)(t.p,{children:"Custom guardrails can be implemented as JavaScript processors. JavaScript processors are custom processors that are written in JavaScript and executed by the Javelin platform. JavaScript processors can be used to implement custom guardrails, data transformations, data validation, data augmentation, and more."}),"\n",(0,s.jsx)(t.h2,{id:"configuration-options",children:"Configuration Options"}),"\n",(0,s.jsxs)(t.p,{children:["Custom guardrails can be enabled by using Javelin's Javascript processor. Make sure to add the ",(0,s.jsx)(t.code,{children:"javascript_processor"})," in the Javelin Request/Response Chain under Processors (Gateway level). You can also enable the processor at the Route level under the Route configuration."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-json",children:'{\n    "name": "Custom Guardrail",\n    "reference": "javascript",\n    "will_block": true,\n    "scope": "local",\n    "inputs": {\n        "js_code": "..."\n    },\n}\n'})}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Note:"})," You can add a JavaScript processor to the processor chain using the Javelin console. This processor can be applied to either the Request or Response chain, at both the Gateway and Route levels. Once added, it becomes interactive, allowing you to directly edit the JavaScript code within the webapp directly. Please note that the JavaScript processor only supports native JavaScript, not ES6+."]}),"\n",(0,s.jsx)(t.h2,{id:"javascript-processor-interface",children:"JavaScript Processor Interface"}),"\n",(0,s.jsx)(t.p,{children:"The JavaScript processor interface consists of the following methods:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",children:"/**\n * The process method is called by the Javelin platform to execute the JavaScript processor.\n * \n * @param {Object} input - The input data to be processed by the JavaScript processor.\n * @returns {Object} output - The output data processed by the JavaScript processor.\n */\nfunction process(input) \n{ \n    var data = JSON.parse(input); \n    \n    if (data.messages && data.messages.length > 0 && data.messages[0].content === 'What is the capital of country?') {\n        data.messages[0].content = 'What is the capital of France?'; \n    } \n\n    var output = { \n        transformed_body: JSON.stringify(data), \n        response_metadata: {}, \n        response_code: '200', \n        response_reason: 'OK' \n    }; \n    \n    return JSON.stringify(output); \n}\n"})}),"\n",(0,s.jsxs)(t.p,{children:["The ",(0,s.jsx)(t.code,{children:"process"})," method is called by the Javelin platform to execute the JavaScript processor. The method takes an input object as a parameter and returns an output object. The input object contains the data to be processed by the JavaScript processor. The output object contains the processed data returned by the JavaScript processor."]}),"\n",(0,s.jsx)(t.p,{children:"The output object should have the following structure:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"transformed_body"}),": The transformed data body."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"response_metadata"}),": The response metadata."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"response_code"}),": The response code."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"response_reason"}),": The response reason."]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"The JavaScript processor can access the input data, process it, and return the processed data. The processed data can be used to implement custom guardrails, data transformations, data validation, data augmentation, and more. Custom Javascript has a 2 second timeout limit - if the processing takes longer than 2 seconds, the processor will be automatically terminated."}),"\n",(0,s.jsxs)(t.p,{children:["Custom guardrails may pass additional metadata such as ",(0,s.jsx)(t.code,{children:'"sensitive_data_detected" = true'})," in metadata. This metadata is propagated into analytics & usage logs in Javelin."]}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Note:"})," Javelin scans the JavaScript processor code for security vulnerabilities before executing it. The JavaScript processor code should be secure and follow best practices to prevent security vulnerabilities."]}),"\n",(0,s.jsx)(t.h2,{id:"custom-validator",children:"Custom Validator"}),"\n",(0,s.jsxs)(t.p,{children:["A ",(0,s.jsx)(t.code,{children:"custom validator"})," for LLM (Large Language Model) requests and responses can be built using Javelin's Custom Guardrail to ensure that the inputs (requests) meet certain format, structure, or content criteria, and that the responses follow the expected format and provide valid outputs. For example, you could validate whether the prompt input is structured correctly or whether the model's response adheres to certain business rules or constraints."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",children:"function process(request) {\n  function customValidator(input) {\n    var request = JSON.parse(input);\n    try {\n      if (request.prompt.trim().length < 10) {\n        throw new Error(\"Prompt must be at least 10 characters long.\");\n      }\n      if (request.prompt.length > 500) {\n        throw new Error(\"Prompt must be no longer than 500 characters.\");\n      }\n\n      return true;\n    } catch (error) {\n      throw new Error(\"This is not a valid prompt format.\")\n    }\n  };\n\n  try {\n    customValidator(request);\n    var output = {\n      transformed_body: JSON.stringify(request),\n      response_metadata: {},\n      response_code: '200',\n      response_reason: 'OK'\n    };\n    return JSON.stringify(output);\n  } catch (error) {\n    var output = {\n      transformed_body: JSON.stringify({\n        error: 'Failed in passing custom validation. Reason:' + error.message\n      }),\n      response_metadata: {},\n      response_code: '400',\n      response_reason: 'Bad Request'\n    };\n    return JSON.stringify(output);\n  }\n}\n"})})]})}function u(e={}){const{wrapper:t}={...(0,n.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},28453:(e,t,a)=>{a.d(t,{R:()=>o,x:()=>i});var s=a(96540);const n={},r=s.createContext(n);function o(e){const t=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:o(e.components),s.createElement(r.Provider,{value:t},e.children)}}}]);